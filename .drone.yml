---
kind: pipeline
type: docker
name: default

clone:
  depth: 1

steps:
- name: Test
  image: golang:1.15-alpine
  when:
    event: push
  commands:
  - apk add gcc musl-dev
  - go test -mod vendor ./...

- name: Build binaries
  image: golang:1.15-alpine
  when:
    event:
    - tag
  commands:
  - apk add git make
  - make build -j$(nproc)

- name: Publish binaries to Github
  image: plugins/github-release
  when:
    event:
    - tag
  settings:
    api_key:
      from_secret: github_secret
    files:
    - bin/gots_darwin_amd64
    - bin/gots_linux_amd64
    - bin/gots_windows_amd64.exe
    checksum:
    - md5
    - sha1
    - sha256
    - sha512
---
kind: signature
hmac: cf137f1b661efff57328c87c254c758fa27bcfb40f34b05c63975a680bea2ddf

...
